<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><link rel="preload" href="./_next/static/media/graziano-casto.17cc67b9.jpg" as="image" fetchpriority="high"/><title>Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto</title><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Greenops to improve your operational efficiency and save the planet","datePublished":"2024-06-26T00:00:00.000Z","dateModified":"2024-06-26T00:00:00.000Z","author":[{"@type":"Person","name":"Graziano Casto","url":"https://castograziano.com/about-me"}]}</script><meta name="description" content="Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto"/><link rel="canonical" href="https://www.castograziano.comhttps://castograziano.com/articles/greenops-kube-green"/><meta property="og:title" content="Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto"/><meta property="og:description" content="Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto"/><meta property="og:url" content="https://www.castograziano.comhttps://castograziano.com/articles/greenops-kube-green"/><meta property="og:image" content="https://castograziano.com/casto_graziano_personal_website.png"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto"/><meta name="twitter:description" content="Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto"/><meta name="twitter:image" content="https://castograziano.com/casto_graziano_personal_website.png"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="icon" href="./images/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="./images/favicon-16x16.png"/><meta name="next-head-count" content="20"/><link rel="preload" href="./_next/static/css/04abda8bc6794ff5.css" as="style"/><link rel="stylesheet" href="./_next/static/css/04abda8bc6794ff5.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="./_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="./_next/static/chunks/webpack-0b5d8249fb15f5f3.js" defer=""></script><script src="./_next/static/chunks/framework-2c16ac744b6cdea6.js" defer=""></script><script src="./_next/static/chunks/main-69b16c27ce463005.js" defer=""></script><script src="./_next/static/chunks/pages/_app-666f3c6bf21653ac.js" defer=""></script><script src="./_next/static/chunks/pages/articles/%5Bslug%5D-0c229d73ad55d035.js" defer=""></script><script src="./_next/static/V8SMYxtGdbar_U_k6rAxK/_buildManifest.js" defer=""></script><script src="./_next/static/V8SMYxtGdbar_U_k6rAxK/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="flex w-full"><div class="fixed inset-0 flex justify-center sm:px-8"><div class="flex w-full max-w-7xl lg:px-8"><div class="w-full bg-white ring-1 ring-zinc-100 dark:bg-zinc-900 dark:ring-zinc-300/20"></div></div></div><div class="relative flex w-full flex-col"><header class="pointer-events-none relative z-50 flex flex-none flex-col" style="height:var(--header-height);margin-bottom:var(--header-mb)"><div class="top-0 z-10 h-16 pt-6" style="position:var(--header-position)"><div class="sm:px-8 top-[var(--header-top,theme(spacing.6))] w-full" style="position:var(--header-inner-position)"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="relative flex gap-4"><div class="flex flex-1"><div class="h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:ring-white/10"><a aria-label="Home" class="pointer-events-auto" href="/"><img alt="" fetchpriority="high" width="1872" height="1914" decoding="async" data-nimg="1" class="rounded-full bg-zinc-100 object-cover dark:bg-zinc-800 h-9 w-9" style="color:transparent" src="./_next/static/media/graziano-casto.17cc67b9.jpg"/></a></div></div><div class="flex flex-1 justify-end md:justify-center"><div class="pointer-events-auto md:hidden" data-headlessui-state=""><button class="group flex items-center rounded-full bg-white/90 px-4 py-2 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10 dark:hover:ring-white/20" type="button" aria-expanded="false" data-headlessui-state="">Menu<svg viewBox="0 0 8 6" aria-hidden="true" class="ml-3 h-auto w-2 stroke-zinc-500 group-hover:stroke-zinc-700 dark:group-hover:stroke-zinc-400"><path d="M1.75 1.75 4 4.25l2.25-2.5" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div><div hidden="" style="position:fixed;top:1px;left:1px;width:1px;height:0;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;display:none"></div><nav class="pointer-events-auto hidden md:block"><ul class="flex rounded-full bg-white/90 px-3 text-sm font-medium text-zinc-800 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur dark:bg-zinc-800/90 dark:text-zinc-200 dark:ring-white/10"><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/about-me/">About</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/articles/">Articles</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/speaking/">Speaking</a></li><li><a class="relative block px-3 py-2 transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects/">Projects</a></li></ul></nav></div><div class="flex justify-end md:flex-1"><div class="pointer-events-auto"><button type="button" aria-label="Toggle theme" class="group rounded-full bg-white/90 px-3 py-2 shadow-lg shadow-zinc-800/5 ring-1 ring-zinc-900/5 backdrop-blur transition dark:bg-zinc-800/90 dark:ring-white/10 dark:hover:ring-white/20"><svg viewBox="0 0 24 24" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" class="h-6 w-6 fill-zinc-100 stroke-zinc-500 transition group-hover:fill-zinc-200 group-hover:stroke-zinc-700 dark:hidden [@media(prefers-color-scheme:dark)]:fill-teal-50 [@media(prefers-color-scheme:dark)]:stroke-teal-500 [@media(prefers-color-scheme:dark)]:group-hover:fill-teal-50 [@media(prefers-color-scheme:dark)]:group-hover:stroke-teal-600"><path d="M8 12.25A4.25 4.25 0 0 1 12.25 8v0a4.25 4.25 0 0 1 4.25 4.25v0a4.25 4.25 0 0 1-4.25 4.25v0A4.25 4.25 0 0 1 8 12.25v0Z"></path><path d="M12.25 3v1.5M21.5 12.25H20M18.791 18.791l-1.06-1.06M18.791 5.709l-1.06 1.06M12.25 20v1.5M4.5 12.25H3M6.77 6.77 5.709 5.709M6.77 17.73l-1.061 1.061" fill="none"></path></svg><svg viewBox="0 0 24 24" aria-hidden="true" class="hidden h-6 w-6 fill-zinc-700 stroke-zinc-500 transition dark:block [@media(prefers-color-scheme:dark)]:group-hover:stroke-zinc-400 [@media_not_(prefers-color-scheme:dark)]:fill-teal-400/10 [@media_not_(prefers-color-scheme:dark)]:stroke-teal-500"><path d="M17.25 16.22a6.937 6.937 0 0 1-9.47-9.47 7.451 7.451 0 1 0 9.47 9.47ZM12.75 7C17 7 17 2.75 17 2.75S17 7 21.25 7C17 7 17 11.25 17 11.25S17 7 12.75 7Z" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></button></div></div></div></div></div></div></div></div></header><main class="flex-auto"><div class="sm:px-8 mt-16 lg:mt-32"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="xl:relative"><div class="mx-auto max-w-2xl"><article><header class="flex flex-col"><h1 class="mt-6 text-4xl font-bold tracking-tight text-zinc-800 sm:text-5xl dark:text-zinc-100">Using Greenops to improve your operational efficiency and save the planet</h1><time dateTime="2024-06-26" class="order-first flex items-center text-base text-zinc-500 dark:text-zinc-400"><span class="h-4 w-0.5 rounded-full bg-zinc-200 dark:bg-zinc-500"></span><span class="ml-3">June 26, 2024</span></time></header><div class="mt-8 prose dark:prose-invert" data-mdx-content="true"><div><p><a href="https://www.infoq.com/articles/greenops-operational-efficiency/">Published by InfoQ</a></p>
<p>Paraphrasing the words of a wise Uncle Ben (from the 2002 movie Spiderman): "With great infrastructures come great responsibilities" and these responsibilities are not only towards the end users of our systems but also towards the environment surrounding us.</p>
<p>The information and communication technology sector alone produces around <a href="https://www.ericsson.com/en/reports-and-papers/industrylab/reports/a-quick-guide-to-your-digital-carbon-footprint">1.4% of overall global emissions</a>. This equates to an estimated <a href="https://www.bbc.com/future/article/20200305-why-your-internet-habits-are-not-as-clean-as-you-think#:~:text=If%20we%20were%20to%20rather,of%20carbon%20dioxide%20a%20year.">1.6 billion tons of greenhouse gas emissions</a>, making each one of us internet users responsible for about <a href="https://www.bbc.com/future/article/20200305-why-your-internet-habits-are-not-as-clean-as-you-think#:~:text=If%20we%20were%20to%20rather,of%20carbon%20dioxide%20a%20year.">400kg of carbon dioxide a year</a>.</p>
<h3>Understand the environmental impact of our systems</h3>
<p>Creating environmentally friendly software involves using data to design programs that produce as little carbon emissions as possible. This requires knowledge from different fields like climate science, computer programming, and how electricity works.</p>
<p>When we talk about "carbon," we mean all the stuff that contributes to global warming. To measure this, we use terms like CO2eq, which tells us how much carbon dioxide is released and carbon intensity measures how much carbon is released for each unit of electricity used.</p>
<p>To figure out how much carbon a software program produces, we need to gather data on how much energy it uses, how dirty that energy is, and what kind of computer it runs on. This can be tricky, even for big companies tracking their own software usage.</p>
<p>To make software greener, we can focus on three things: making it use less energy, raising awareness about carbon emissions, and using more efficient hardware.</p>
<p>To reduce carbon emissions without reducing the actual energy usage of our infrastructure, accessing data on the carbon intensity of data centers is necessary. This allows us to set up a <a href="https://learn.greensoftware.foundation/carbon-awareness/#spatial-shifting">spatial</a> or <a href="https://learn.greensoftware.foundation/carbon-awareness/#temporal-shifting">temporal</a> shifting strategy, thereby prioritizing the use of renewable energy sources where available.</p>
<p>Since putting these strategies into action involves optimizing the workloads that use our infrastructure, and considering that upgrading to more efficient hardware can be expensive and challenging, the easiest and fastest way to enhance our environmental impact is by reducing energy consumption. But how can we achieve this without compromising the availability of our systems?</p>
<h3>Zombies are real, and they are just around the corner</h3>
<p>In simplest terms, the software lifecycle typically involves at least 4 phases: a design phase where the system is conceptualized and experiments may be conducted, a development phase where all features to be implemented are built, and a release phase to put the developed software into production, but not before testing everything in a secure environment.</p>
<p>To implement a workflow as described, we'll need at least three different environments: the first being a development environment that will be useful for both the design and implementation phases, a staging or pre-production environment to test our software before delivering it to end users, and finally the production environment.</p>
<p><img src="/blog//green-ops-kube-green/green-ops-kube-green-1.webp" alt=""></p>
<p>These three environments have different availability requirements: the development and pre-production environments will be useful to engineers only during working hours, while the production environment needs to be constantly up and running. Additionally, transitioning from one environment to another often leaves behind remnants that linger in our infrastructure like zombies, consuming resources without serving a useful purpose in the overall software lifecycle.</p>
<h3>Kill them all and save the planet</h3>
<p>Suppose we hypothetically set an ideal case where all environments have the same number of pods running on the same infrastructure with a consistent and overlapping computational demand. We can assert that by keeping the development and staging environments constantly active even outside working hours, we're using more resources than necessary for 128 out of the total 168 hours in a week, which equates to approximately 103% more usage than what is actually required. In other words, by keeping the development and staging environments always active, engineers would effectively utilize them for only about 23% of their actual consumption.</p>
<p>With this simple example, it is evident how significant the amount of resources that engineering companies waste every day is. Fortunately, remedying this requires nothing more than a handful of configuration lines and the installation of a Kubernetes operator on our clusters. <a href="https://github.com/kube-green/kube-green">kube-green</a> is an add-on for Kubernetes that, once installed, allows you to automatically shut down Kubernetes resources when they are not needed and restart them when they are, all in an automated manner simply by configuring the CRD SleepInfo.</p>
<pre><code class="language-yaml">apiVersion: kube-green.com/v1alpha1
kind: SleepInfo
metadata:
	name: working-hours
spec:
	weekdays: "1-5"
	sleepAt: "20:00"
	wakeUpAt: "08:00"
	timeZone: "Europe/Rome"
	suspendCronJobs: true
	excludeRef:
          - apiVersion: "apps/v1"
            kind:       Deployment
            name:       my-deployment
</code></pre>
<p>With just a few lines of configuration like those in the previous image, you can define that all namespaces on the cluster with Kube-green are available only from Monday to Friday and only during the hours from 8 AM to 8 PM in the Rome timezone.</p>
<p>With the current Kube-green version, both Deployments and CronJobs can be managed, but with the <a href="https://github.com/kube-green/kube-green/releases/tag/v0.6.0-rc.1">next version</a> all the Kubernetes resources will be supported.</p>
<p>In the case of Deployments, to stop the resource, the ReplicaSet is set to zero and then reset to its previous value to restart it. Conversely, to suspend CronJobs, they are marked as suspended.</p>
<p>In the SleepInfo configurations, you can also specify resources that should not be suspended, such as the "my-deployment" in the example configuration provided above.</p>
<h3>Data not just words: a real-world kube-green usage report</h3>
<p>The following configuration of kube-green was used to suspend 48 out of 75 namespaces outside of working hours while keeping all deployments with the name api-gateway active.</p>
<pre><code class="language-yaml">apiVersion: kube-green.com/v1alpha1
kind: SleepInfo
metadata:
	name: working-hours
spec: 
	weekdays: "1-5"
	sleepAt: "20:00"
	wakeUpAt: "08:00"
	timeZone: "Europe/Rome"
	suspendCronJobs: true
	excludeRef:
         - apiVersion: "apps/v1"
           kind:       Deployment
           name:       api-gateway
</code></pre>
<p>A cluster of this size, operating without kube-green, manages an average of 1050 pods with an allocated amount of resources equal to 75 GB of memory and 45 CPUs. In terms of actual resource consumption, the cluster records usage of 45 GB of memory and 4.5 CPUs, emitting approximately 222 kg of CO2 into the environment per week.</p>
<p>By configuring SleepInfo on this cluster, we can reduce the total number of pods by 600, bringing it down to 450. The allocated memory decreases to 30 GB, and the CPUs decrease to only 15. With kube-green, there is also a decrease in terms of resource consumption, with memory usage reduced to 21 GB and CPUs reduced to 1, resulting in emissions of approximately 139 kg of CO2.</p>
<p>|                       | without kube-green | with kube-green | difference |
| :-------------------- | :----------------- | :-------------: | ---------: |
| number of pods        | 1050               |       450       |        600 |
| memory consumed [Gb]  | 54                 |       21        |         33 |
| CPU consumed [cpu]    | 4.5                |        1        |        3.5 |
| memory allocated [Gb] | 75                 |       30        |         45 |
| CPU allocated [cpu]   | 40                 |       15        |         25 |
| CO2eq/week [kg]       | 222                |       139       |         83 |</p>
<p>The use of kube-green on this cluster during the study week resulted in emitting approximately 83 kg of CO2eq into the environment, which is 38% less than what we would have emitted under normal circumstances. These numbers become even more impressive when projected over the entire year, resulting in approximately 4000 kg less CO2eq emitted thanks to the simple use of kube-green.</p>
<p>To put it into perspective, this reduction is <a href="https://www.epa.gov/greenvehicles/greenhouse-gas-emissions-typical-passenger-vehicle">equivalent to the carbon emissions from an average car</a> traveling approximately 16,000 km.</p>
<p><img src="/blog//green-ops-kube-green/green-ops-kube-green-2.webp" alt=""></p>
<p><img src="/blog//green-ops-kube-green/green-ops-kube-green-3.webp" alt=""></p>
<p><img src="/blog//green-ops-kube-green/green-ops-kube-green-4.webp" alt=""></p>
<p><img src="/blog//green-ops-kube-green/green-ops-kube-green-5.webp" alt=""></p>
<p>In this specific use case, as evidenced by the snapshots of resource usage metrics, the use of kube-green has allowed for a significant decrease in resource utilization, enabling the downscaling of the number of nodes in the cluster. On average, 4 nodes are stopped during the night and on weekends, each of which has a size of 2 CPU cores and 8 GB of memory.</p>
<p>This brings several benefits, not only reducing CO2 emissions but also directly proportional cost savings for our cluster. This is because the pricing structure of clusters in major cloud providers is typically based on the number of nodes used. By scaling down the number of nodes when they are not needed, we effectively reduce the cost of operating the cluster.</p>
<h3>The future of kube-green</h3>
<p>The kube-green project is constantly evolving, and as mentioned earlier, we are already working on improvements that will make kube-green a better tool, hopefully making the world a better place as well.</p>
<p>In the next release of kube-green, all resources available in Kubernetes will be supported. Instead of directly acting on specific resources, it will be possible to define rules to schedule the shutdown and possibly the startup of any resource at defined times.</p>
<p>With these patches, kube-green's support won't be limited to just Deployments and CronJobs but will also extend to ReplicaSets, Pods, StatefulSets, and any other custom CRDs.</p>
<pre><code class="language-yml">apiVersion: kube-green.com/v1alpha1
kind: SleepInfo
metadata:
	name: working-hours
spec:
	weekdays: "*"
	sleepAt: "20:00"
	wakeUpAt: "08:00"
	suspendCronJobs: true
	patches:
        - target:
             group: apps
             kind: StatefulSet
          patch:  
            - path: /spec/replicas
              op: add
              value: 0
       - target:
            group: apps
            kind: ReplicaSet
         patch:
           - path: /spec/replicas
             op: add
             value: 0
	excludeRef:
        - apiVersion: "apps/v1"
          kind:       StatefulSet
          name:       do-not-sleep
        - matchLabels:
            kube-green.dev/exclude: "true"
</code></pre>
<p>We are experimenting with solutions that would allow kube-green to interact with other operators like <a href="https://www.crossplane.io/">Crossplane</a>. This would enable scheduling the shutdown and restart of entire pieces of infrastructure managed through this tool.</p>
<p>Anyone who wants to share their thoughts or contribute directly to the project with ideas, code, or content can take a look at the <a href="https://github.com/kube-green/kube-green">repository on GitHub</a> or contact us directly.</p>
<h3>Use your resources consciously: keep what you need when you need it</h3>
<p>These days, our easy access to resources has made us a bit less mindful of how we use them. An unused pod isn't just an unused pod; in the long run, it has a significant impact on our overall carbon footprint.</p>
<p>GreenOps allows us to have a significant positive impact on the environment with a negligible impact on our architectures. With minimal additional effort, we can ensure that our clusters use resources much more efficiently and without waste.</p>
<p>With modern approaches, we can implement our GreenOps strategy without drastically altering the management of our workloads, while also achieving positive impacts on our infrastructure costs. GreenOps and FinOps are extremely related concepts, and often, rationalizing our resources from a sustainability perspective leads to savings on our cloud bills.</p>
<p>To make informed decisions, it is essential to have visibility into both the costs of our clusters and their CO2eq emissions into the environment. For this reason, many cost monitoring tools, such as <a href="https://www.opencost.io/">OpenCost</a>, have introduced carbon cost emissions tracking across Kubernetes and cloud spending.</p>
<p>In conclusion, GreenOps can be the first step in aligning our operational practices with environmental sustainability before implementing more complex strategies aimed at using more efficient hardware or preferring renewable energy sources. With GreenOps techniques, you can improve your environmental impact from day one and see immediate results. This allows you to collect data and move more consciously in the vast world of eco-friendly software.</p>
</div></div></article></div></div></div></div></div></div></main><footer class="mt-32 flex-none"><div class="sm:px-8"><div class="mx-auto w-full max-w-7xl lg:px-8"><div class="border-t border-zinc-100 pb-16 pt-10 dark:border-zinc-700/40"><div class="relative px-4 sm:px-8 lg:px-12"><div class="mx-auto max-w-2xl lg:max-w-5xl"><div class="flex flex-col items-center justify-between gap-6 sm:flex-row"><div class="flex flex-wrap justify-center gap-x-6 gap-y-1 text-sm font-medium text-zinc-800 dark:text-zinc-200"><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/about-me/">About</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/projects/">Projects</a><a class="transition hover:text-teal-500 dark:hover:text-teal-400" href="/speaking/">Speaking</a></div><p class="text-sm text-zinc-500 dark:text-zinc-400">Â© <!-- -->2025<!-- --> Graziano Casto. All rights reserved.</p></div></div></div></div></div></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"data":{"article":{"title":"Using Greenops to improve your operational efficiency and save the planet","date":"2024-06-26"},"children":"\u003cp\u003e\u003ca href=\"https://www.infoq.com/articles/greenops-operational-efficiency/\"\u003ePublished by InfoQ\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eParaphrasing the words of a wise Uncle Ben (from the 2002 movie Spiderman): \"With great infrastructures come great responsibilities\" and these responsibilities are not only towards the end users of our systems but also towards the environment surrounding us.\u003c/p\u003e\n\u003cp\u003eThe information and communication technology sector alone produces around \u003ca href=\"https://www.ericsson.com/en/reports-and-papers/industrylab/reports/a-quick-guide-to-your-digital-carbon-footprint\"\u003e1.4% of overall global emissions\u003c/a\u003e. This equates to an estimated \u003ca href=\"https://www.bbc.com/future/article/20200305-why-your-internet-habits-are-not-as-clean-as-you-think#:~:text=If%20we%20were%20to%20rather,of%20carbon%20dioxide%20a%20year.\"\u003e1.6 billion tons of greenhouse gas emissions\u003c/a\u003e, making each one of us internet users responsible for about \u003ca href=\"https://www.bbc.com/future/article/20200305-why-your-internet-habits-are-not-as-clean-as-you-think#:~:text=If%20we%20were%20to%20rather,of%20carbon%20dioxide%20a%20year.\"\u003e400kg of carbon dioxide a year\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eUnderstand the environmental impact of our systems\u003c/h3\u003e\n\u003cp\u003eCreating environmentally friendly software involves using data to design programs that produce as little carbon emissions as possible. This requires knowledge from different fields like climate science, computer programming, and how electricity works.\u003c/p\u003e\n\u003cp\u003eWhen we talk about \"carbon,\" we mean all the stuff that contributes to global warming. To measure this, we use terms like CO2eq, which tells us how much carbon dioxide is released and carbon intensity measures how much carbon is released for each unit of electricity used.\u003c/p\u003e\n\u003cp\u003eTo figure out how much carbon a software program produces, we need to gather data on how much energy it uses, how dirty that energy is, and what kind of computer it runs on. This can be tricky, even for big companies tracking their own software usage.\u003c/p\u003e\n\u003cp\u003eTo make software greener, we can focus on three things: making it use less energy, raising awareness about carbon emissions, and using more efficient hardware.\u003c/p\u003e\n\u003cp\u003eTo reduce carbon emissions without reducing the actual energy usage of our infrastructure, accessing data on the carbon intensity of data centers is necessary. This allows us to set up a \u003ca href=\"https://learn.greensoftware.foundation/carbon-awareness/#spatial-shifting\"\u003espatial\u003c/a\u003e or \u003ca href=\"https://learn.greensoftware.foundation/carbon-awareness/#temporal-shifting\"\u003etemporal\u003c/a\u003e shifting strategy, thereby prioritizing the use of renewable energy sources where available.\u003c/p\u003e\n\u003cp\u003eSince putting these strategies into action involves optimizing the workloads that use our infrastructure, and considering that upgrading to more efficient hardware can be expensive and challenging, the easiest and fastest way to enhance our environmental impact is by reducing energy consumption. But how can we achieve this without compromising the availability of our systems?\u003c/p\u003e\n\u003ch3\u003eZombies are real, and they are just around the corner\u003c/h3\u003e\n\u003cp\u003eIn simplest terms, the software lifecycle typically involves at least 4 phases: a design phase where the system is conceptualized and experiments may be conducted, a development phase where all features to be implemented are built, and a release phase to put the developed software into production, but not before testing everything in a secure environment.\u003c/p\u003e\n\u003cp\u003eTo implement a workflow as described, we'll need at least three different environments: the first being a development environment that will be useful for both the design and implementation phases, a staging or pre-production environment to test our software before delivering it to end users, and finally the production environment.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blog//green-ops-kube-green/green-ops-kube-green-1.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eThese three environments have different availability requirements: the development and pre-production environments will be useful to engineers only during working hours, while the production environment needs to be constantly up and running. Additionally, transitioning from one environment to another often leaves behind remnants that linger in our infrastructure like zombies, consuming resources without serving a useful purpose in the overall software lifecycle.\u003c/p\u003e\n\u003ch3\u003eKill them all and save the planet\u003c/h3\u003e\n\u003cp\u003eSuppose we hypothetically set an ideal case where all environments have the same number of pods running on the same infrastructure with a consistent and overlapping computational demand. We can assert that by keeping the development and staging environments constantly active even outside working hours, we're using more resources than necessary for 128 out of the total 168 hours in a week, which equates to approximately 103% more usage than what is actually required. In other words, by keeping the development and staging environments always active, engineers would effectively utilize them for only about 23% of their actual consumption.\u003c/p\u003e\n\u003cp\u003eWith this simple example, it is evident how significant the amount of resources that engineering companies waste every day is. Fortunately, remedying this requires nothing more than a handful of configuration lines and the installation of a Kubernetes operator on our clusters. \u003ca href=\"https://github.com/kube-green/kube-green\"\u003ekube-green\u003c/a\u003e is an add-on for Kubernetes that, once installed, allows you to automatically shut down Kubernetes resources when they are not needed and restart them when they are, all in an automated manner simply by configuring the CRD SleepInfo.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: kube-green.com/v1alpha1\nkind: SleepInfo\nmetadata:\n\tname: working-hours\nspec:\n\tweekdays: \"1-5\"\n\tsleepAt: \"20:00\"\n\twakeUpAt: \"08:00\"\n\ttimeZone: \"Europe/Rome\"\n\tsuspendCronJobs: true\n\texcludeRef:\n          - apiVersion: \"apps/v1\"\n            kind:       Deployment\n            name:       my-deployment\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWith just a few lines of configuration like those in the previous image, you can define that all namespaces on the cluster with Kube-green are available only from Monday to Friday and only during the hours from 8 AM to 8 PM in the Rome timezone.\u003c/p\u003e\n\u003cp\u003eWith the current Kube-green version, both Deployments and CronJobs can be managed, but with the \u003ca href=\"https://github.com/kube-green/kube-green/releases/tag/v0.6.0-rc.1\"\u003enext version\u003c/a\u003e all the Kubernetes resources will be supported.\u003c/p\u003e\n\u003cp\u003eIn the case of Deployments, to stop the resource, the ReplicaSet is set to zero and then reset to its previous value to restart it. Conversely, to suspend CronJobs, they are marked as suspended.\u003c/p\u003e\n\u003cp\u003eIn the SleepInfo configurations, you can also specify resources that should not be suspended, such as the \"my-deployment\" in the example configuration provided above.\u003c/p\u003e\n\u003ch3\u003eData not just words: a real-world kube-green usage report\u003c/h3\u003e\n\u003cp\u003eThe following configuration of kube-green was used to suspend 48 out of 75 namespaces outside of working hours while keeping all deployments with the name api-gateway active.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yaml\"\u003eapiVersion: kube-green.com/v1alpha1\nkind: SleepInfo\nmetadata:\n\tname: working-hours\nspec: \n\tweekdays: \"1-5\"\n\tsleepAt: \"20:00\"\n\twakeUpAt: \"08:00\"\n\ttimeZone: \"Europe/Rome\"\n\tsuspendCronJobs: true\n\texcludeRef:\n         - apiVersion: \"apps/v1\"\n           kind:       Deployment\n           name:       api-gateway\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eA cluster of this size, operating without kube-green, manages an average of 1050 pods with an allocated amount of resources equal to 75 GB of memory and 45 CPUs. In terms of actual resource consumption, the cluster records usage of 45 GB of memory and 4.5 CPUs, emitting approximately 222 kg of CO2 into the environment per week.\u003c/p\u003e\n\u003cp\u003eBy configuring SleepInfo on this cluster, we can reduce the total number of pods by 600, bringing it down to 450. The allocated memory decreases to 30 GB, and the CPUs decrease to only 15. With kube-green, there is also a decrease in terms of resource consumption, with memory usage reduced to 21 GB and CPUs reduced to 1, resulting in emissions of approximately 139 kg of CO2.\u003c/p\u003e\n\u003cp\u003e|                       | without kube-green | with kube-green | difference |\n| :-------------------- | :----------------- | :-------------: | ---------: |\n| number of pods        | 1050               |       450       |        600 |\n| memory consumed [Gb]  | 54                 |       21        |         33 |\n| CPU consumed [cpu]    | 4.5                |        1        |        3.5 |\n| memory allocated [Gb] | 75                 |       30        |         45 |\n| CPU allocated [cpu]   | 40                 |       15        |         25 |\n| CO2eq/week [kg]       | 222                |       139       |         83 |\u003c/p\u003e\n\u003cp\u003eThe use of kube-green on this cluster during the study week resulted in emitting approximately 83 kg of CO2eq into the environment, which is 38% less than what we would have emitted under normal circumstances. These numbers become even more impressive when projected over the entire year, resulting in approximately 4000 kg less CO2eq emitted thanks to the simple use of kube-green.\u003c/p\u003e\n\u003cp\u003eTo put it into perspective, this reduction is \u003ca href=\"https://www.epa.gov/greenvehicles/greenhouse-gas-emissions-typical-passenger-vehicle\"\u003eequivalent to the carbon emissions from an average car\u003c/a\u003e traveling approximately 16,000 km.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blog//green-ops-kube-green/green-ops-kube-green-2.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blog//green-ops-kube-green/green-ops-kube-green-3.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blog//green-ops-kube-green/green-ops-kube-green-4.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/blog//green-ops-kube-green/green-ops-kube-green-5.webp\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eIn this specific use case, as evidenced by the snapshots of resource usage metrics, the use of kube-green has allowed for a significant decrease in resource utilization, enabling the downscaling of the number of nodes in the cluster. On average, 4 nodes are stopped during the night and on weekends, each of which has a size of 2 CPU cores and 8 GB of memory.\u003c/p\u003e\n\u003cp\u003eThis brings several benefits, not only reducing CO2 emissions but also directly proportional cost savings for our cluster. This is because the pricing structure of clusters in major cloud providers is typically based on the number of nodes used. By scaling down the number of nodes when they are not needed, we effectively reduce the cost of operating the cluster.\u003c/p\u003e\n\u003ch3\u003eThe future of kube-green\u003c/h3\u003e\n\u003cp\u003eThe kube-green project is constantly evolving, and as mentioned earlier, we are already working on improvements that will make kube-green a better tool, hopefully making the world a better place as well.\u003c/p\u003e\n\u003cp\u003eIn the next release of kube-green, all resources available in Kubernetes will be supported. Instead of directly acting on specific resources, it will be possible to define rules to schedule the shutdown and possibly the startup of any resource at defined times.\u003c/p\u003e\n\u003cp\u003eWith these patches, kube-green's support won't be limited to just Deployments and CronJobs but will also extend to ReplicaSets, Pods, StatefulSets, and any other custom CRDs.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-yml\"\u003eapiVersion: kube-green.com/v1alpha1\nkind: SleepInfo\nmetadata:\n\tname: working-hours\nspec:\n\tweekdays: \"*\"\n\tsleepAt: \"20:00\"\n\twakeUpAt: \"08:00\"\n\tsuspendCronJobs: true\n\tpatches:\n        - target:\n             group: apps\n             kind: StatefulSet\n          patch:  \n            - path: /spec/replicas\n              op: add\n              value: 0\n       - target:\n            group: apps\n            kind: ReplicaSet\n         patch:\n           - path: /spec/replicas\n             op: add\n             value: 0\n\texcludeRef:\n        - apiVersion: \"apps/v1\"\n          kind:       StatefulSet\n          name:       do-not-sleep\n        - matchLabels:\n            kube-green.dev/exclude: \"true\"\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe are experimenting with solutions that would allow kube-green to interact with other operators like \u003ca href=\"https://www.crossplane.io/\"\u003eCrossplane\u003c/a\u003e. This would enable scheduling the shutdown and restart of entire pieces of infrastructure managed through this tool.\u003c/p\u003e\n\u003cp\u003eAnyone who wants to share their thoughts or contribute directly to the project with ideas, code, or content can take a look at the \u003ca href=\"https://github.com/kube-green/kube-green\"\u003erepository on GitHub\u003c/a\u003e or contact us directly.\u003c/p\u003e\n\u003ch3\u003eUse your resources consciously: keep what you need when you need it\u003c/h3\u003e\n\u003cp\u003eThese days, our easy access to resources has made us a bit less mindful of how we use them. An unused pod isn't just an unused pod; in the long run, it has a significant impact on our overall carbon footprint.\u003c/p\u003e\n\u003cp\u003eGreenOps allows us to have a significant positive impact on the environment with a negligible impact on our architectures. With minimal additional effort, we can ensure that our clusters use resources much more efficiently and without waste.\u003c/p\u003e\n\u003cp\u003eWith modern approaches, we can implement our GreenOps strategy without drastically altering the management of our workloads, while also achieving positive impacts on our infrastructure costs. GreenOps and FinOps are extremely related concepts, and often, rationalizing our resources from a sustainability perspective leads to savings on our cloud bills.\u003c/p\u003e\n\u003cp\u003eTo make informed decisions, it is essential to have visibility into both the costs of our clusters and their CO2eq emissions into the environment. For this reason, many cost monitoring tools, such as \u003ca href=\"https://www.opencost.io/\"\u003eOpenCost\u003c/a\u003e, have introduced carbon cost emissions tracking across Kubernetes and cloud spending.\u003c/p\u003e\n\u003cp\u003eIn conclusion, GreenOps can be the first step in aligning our operational practices with environmental sustainability before implementing more complex strategies aimed at using more efficient hardware or preferring renewable energy sources. With GreenOps techniques, you can improve your environmental impact from day one and see immediate results. This allows you to collect data and move more consciously in the vast world of eco-friendly software.\u003c/p\u003e\n","pageTitle":"Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto","pageDescription":"Using Greenops to improve your operational efficiency and save the planet - by Graziano Casto","pageLink":"https://castograziano.com/articles/greenops-kube-green","pageImage":"https://castograziano.com/casto_graziano_personal_website.png"},"schema":{"@context":"https://schema.org","@type":"BlogPosting","headline":"Using Greenops to improve your operational efficiency and save the planet","datePublished":"2024-06-26T00:00:00.000Z","dateModified":"2024-06-26T00:00:00.000Z","author":[{"@type":"Person","name":"Graziano Casto","url":"https://castograziano.com/about-me"}]}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"greenops-kube-green"},"buildId":"V8SMYxtGdbar_U_k6rAxK","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>